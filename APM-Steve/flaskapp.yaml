apiVersion: v1
kind: Pod
metadata:
  name: flaskapp
  labels:
    tags.datadoghq.com/env: "test"
    tags.datadoghq.com/service: "flask"
    tags.datadoghq.com/version: "1.0.0"
  annotations:
    ad.datadoghq.com/tags: '{"app": "test"}'
spec:
  containers:
  - name: flaskapp
    image: flaskapm:latest
    imagePullPolicy: IfNotPresent
    # --- ADD THIS ---
    env:
    - name: DD_TRACE_AGENT_URL
      value: 'unix:///var/run/datadog/apm.socket'
    - name: DD_TRACE_DEBUG
      value: 'true'
    - name: DD_TRACE_LOG_FILE
      value: ddtrace_logs.log
    # - name: DD_ENV
    #   valueFrom:
    #     fieldRef:
    #       fieldPath: metadata.labels['tags.datadoghq.com/env']
    # - name: DD_SERVICE
    #   valueFrom:
    #     fieldRef:
    #       fieldPath: metadata.labels['tags.datadoghq.com/service']
    # - name: DD_VERSION
    #   valueFrom:
    #     fieldRef:
    #       fieldPath: metadata.labels['tags.datadoghq.com/version']
    - name: DD_DYNAMIC_INSTRUMENTATION_ENABLED
      value: 'true'
    volumeMounts:
    - name: apmsocketpath
      mountPath: /var/run/datadog
  volumes:
  - hostPath:
      path: /var/run/datadog/
    name: apmsocketpath 
